% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/scKNN.R
\name{scKNN}
\alias{scKNN}
\title{Main Analysis Function for Single-Cell KNN Variance Component Testing}
\usage{
scKNN(
  pheno.donor,
  counts.mat,
  annotation,
  gene.regions = NULL,
  input.kernel = NULL,
  method = "KNN",
  MINQUE.type = "MINQUE0",
  lambda.seq = c(0, 0.01, 0.1, 1),
  fixed.lambda = 0,
  n.folds = 5,
  cv.criteria = "MSE",
  individual.test.type = c("KNN.ind.test", "KNN.overall.test"),
  design.mat = NULL,
  verbose = TRUE,
  significance.level = 0.05
)
}
\arguments{
\item{pheno.donor}{Numeric vector of phenotype values for each donor}

\item{counts.mat}{Numeric matrix of gene expression counts (genes x cells)}

\item{annotation}{Data frame with cell-level annotations containing:
\describe{
\item{cell.type}{Factor indicating the cell type of each cell}
\item{donor}{Factor indicating the donor/individual of each cell}
}}

\item{gene.regions}{Optional list of gene regions for stratified analysis.
Each element should be a character vector of gene names. If NULL (default),
all genes are treated as one region.}

\item{input.kernel}{Character vector specifying kernel types (default "product")}

\item{method}{Character string, either "LMM" or "KNN" (default)}

\item{MINQUE.type}{Character string, either "MINQUE0" (default) or "MINQUE1"}

\item{lambda.seq}{Numeric vector of lambda values for cross-validation. If NULL,
cross-validation is skipped and fixed.lambda is used.}

\item{fixed.lambda}{Numeric value for lambda when skipping cross-validation. Only
used when lambda.seq is NULL. Default is 0 (no regularization).}

\item{n.folds}{Integer number of CV folds (default = 5)}

\item{cv.criteria}{CV selection criterion: "MSE" (default), "correlation", or "R2"}

\item{individual.test.type}{Character string for individual tests:
\describe{
\item{"KNN.ind.test"}{Use KNN.ind.test function (default)}
\item{"KNN.overall.test"}{Use KNN.overall.test function for each component}
}}

\item{design.mat}{Optional design matrix for fixed effects (covariates)}

\item{verbose}{Logical, whether to print progress messages (default TRUE)}

\item{significance.level}{Numeric, significance level for tests (default 0.05)}
}
\value{
A list of class "scKNN.result" containing:
\describe{
\item{individual.pvalues}{Matrix of p-values for individual tests}
\item{overall.pvalue}{P-value for the overall test}
\item{significant.components}{List of significant components}
\item{variance.estimates}{Estimated variance components}
\item{component.info}{Data frame with component descriptions}
\item{optimal.lambda}{Selected lambda value from cross-validation}
\item{cv.results}{Full cross-validation results}
\item{method}{Method used (LMM or KNN)}
\item{n.components.tested}{Number of components tested}
}
}
\description{
This is the main function for the scKNN package that performs variance
component testing for single-cell RNA-seq data. It automatically tests
all cell type and gene region combinations, providing both individual
and overall hypothesis tests.
}
\examples{
\dontrun{
# Load example data
data(scKNN_data)

# Basic usage - tests all cell types and all genes
result1 <- scKNN(pheno.donor, counts.mat, annotation)

# With gene regions
regions <- list(pathway1 = c("Gene1", "Gene2", "Gene3"),
                pathway2 = c("Gene4", "Gene5"))
result2 <- scKNN(pheno.donor, counts.mat, annotation,
                 gene.regions = regions)

# Using fixed lambda (no cross-validation)
result3 <- scKNN(pheno.donor, counts.mat, annotation,
                 lambda.seq = NULL,
                 fixed.lambda = 0.1)

# Using different individual test type
result4 <- scKNN(pheno.donor, counts.mat, annotation,
                 individual.test.type = "KNN.overall.test")

# View results
print(result3)
summary(result3)
}
}
