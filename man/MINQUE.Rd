% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/MINQUE.R
\name{MINQUE}
\alias{MINQUE}
\title{Minimum Norm Quadratic Unbiased Estimation (MINQUE) for Single-Cell Data}
\usage{
MINQUE(
  pheno.donor,
  counts.mat,
  annotation,
  gene.regions = NULL,
  input.kernel = NULL,
  MINQUE.type = "MINQUE0",
  method = "KNN",
  lambda = 0,
  weight = NULL,
  design.mat = NULL,
  constrain = FALSE,
  variance.component.list = NULL
)
}
\arguments{
\item{pheno.donor}{Numeric vector of phenotype values for each donor. Length
must equal the number of unique donors in \code{annotation}.}

\item{counts.mat}{Numeric matrix of gene expression counts with genes in rows
and cells in columns. Row names should be gene identifiers.}

\item{annotation}{Data frame with cell-level annotations containing:
\describe{
\item{cell.type}{Factor indicating the cell type of each cell}
\item{donor}{Factor indicating the donor/individual of each cell}
}}

\item{gene.regions}{A list where each element is a character vector of gene names
defining a gene region. If NULL (default), all genes are treated as one region.
Example: list(c("Gene1", "Gene2"), c("Gene3", "Gene4", "Gene5"))}

\item{input.kernel}{Character vector specifying kernel types for each cell type.
Options include "product", "gaussian", "polynomial", etc. If NULL (default),
uses "product" kernel for all cell types.}

\item{MINQUE.type}{Character string specifying the MINQUE estimator type:
\describe{
\item{"MINQUE0"}{Assumes all variance components are equal (default)}
\item{"MINQUE1"}{Uses initial weights for variance components}
}}

\item{method}{Character string specifying the variance component model:
\describe{
\item{"LMM"}{Linear mixed model with first-order kernels only}
\item{"KNN"}{Kernel neural network with first and second-order terms (default)}
}}

\item{lambda}{Numeric regularization parameter (default = 0). Larger values
encourage sparsity in variance components.}

\item{weight}{Numeric vector of initial weights for variance components. Used
only when \code{MINQUE.type = "MINQUE1"}. If NULL, uses equal weights.}

\item{design.mat}{Optional design matrix for fixed effects (covariates). Each
column represents a covariate, rows correspond to donors.}

\item{constrain}{Logical indicating whether to constrain variance components
to be non-negative (default = FALSE).}

\item{variance.component.list}{Optional pre-computed list of variance component
matrices. If NULL, computed internally using \code{KNN2LMM}.}
}
\value{
A list containing:
\describe{
\item{theta}{Numeric vector of estimated variance components}
\item{beta}{Numeric vector of fixed effects coefficients (if design.mat provided)}
\item{Cmat}{Inverse of the C matrix used in estimation}
\item{Qmat}{Precision matrix Q = V^(-1)}
\item{variance.component.list}{List of variance component matrices used}
}
}
\description{
Estimates variance components from single-cell RNA-seq data using MINQUE
(Minimum Norm Quadratic Unbiased Estimation). This function integrates
single-cell expression data with donor-level phenotypes to estimate the
contribution of different cell types to phenotypic variation.
}
\details{
MINQUE is a method-of-moments approach for estimating variance components
without requiring distributional assumptions. The algorithm:
\enumerate{
\item Constructs kernel matrices from single-cell data via pseudobulk aggregation
\item Initializes the V matrix based on MINQUE type
\item Computes quadratic forms for estimation
\item Solves for variance components using generalized least squares
}

The regularization parameter \code{lambda} adds a ridge penalty to all variance
components except the residual variance (first component).
}
\examples{
\dontrun{
# Load example data
data(counts.mat)
data(annotation)
data(pheno.donor)

# Basic usage with default settings
result <- MINQUE(pheno.donor, counts.mat, annotation)
print(result$theta)

# With covariates
design.mat <- cbind(1, rnorm(length(pheno.donor))) # intercept + covariate
result_cov <- MINQUE(pheno.donor, counts.mat, annotation,
                     design.mat = design.mat)

# Using MINQUE1 with custom weights
n_components <- length(unique(annotation$cell.type)) + 1
custom_weights <- rep(1/n_components, n_components)
result_minque1 <- MINQUE(pheno.donor, counts.mat, annotation,
                         MINQUE.type = "MINQUE1",
                         weight = custom_weights)
}
\dontrun{
# Advanced example with regularization
# Test different lambda values
lambdas <- c(0, 0.1, 1, 10)
results <- lapply(lambdas, function(l) {
  MINQUE(pheno.donor, counts.mat, annotation,
         lambda = l, constrain = TRUE)
})

# Compare variance component estimates
theta_mat <- sapply(results, function(x) x$theta)
matplot(lambdas, t(theta_mat), type = "b",
        xlab = "Lambda", ylab = "Variance Component",
        main = "Regularization Path")
}

}
\references{
Rao, C.R. (1971). "Estimation of variance and covariance components - MINQUE
theory." Journal of Multivariate Analysis, 1(3), 257-275.

Zhu, Z., & Zhang, X. (2020). "Penalized variance component analysis of
complex traits with single-cell data." Nature Communications, 11(1), 1-12.
}
\seealso{
\code{\link{KNN2LMM}} for variance component construction,
\code{\link{findKernel}} for kernel computation
}
